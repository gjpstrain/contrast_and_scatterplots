corr_model <- lm(V2 ~ V1, data = corr_data)
my_residuals <- abs(residuals(corr_model))
data_with_resid <- round(cbind(corr_data, my_residuals), 2)
plot_example_function <- function (d, x, t) {
ggplot(d, aes(x = V1, y = V2)) +
scale_alpha_identity() +
geom_point(aes(alpha = x), shape = 16, size = 3)  +
labs(x = "", y = "") +
theme_classic() +
theme(axis.text = element_blank(),
plot.margin = unit(c(0,0,0,0), "cm"),
legend.position = "none",
plot.title = element_text(size = 30)) +
labs(title = t)
}
plot_example_function(data_with_resid, 0.25, "Contrast Alpha = 0.25")
plot_example_function(data_with_resid, 0.5, "Contrast Alpha = 0.5")
plot_example_function(data_with_resid, 0.75, "Contrast Alpha = 0.75")
plot_example_function(data_with_resid, 1, "Contrast Alpha = 1")
dot_plot_function(E1_uniform_adjustments_tidy) +
scale_x_discrete(labels = c("Low Contrast\nalpha = 0.25 (A)",
"Medium Contrast\nalpha = 0.5 (B)",
"High Contrast\nalpha = 0.75 (C)",
"Full Contrast\nalpha = 1 (D)"))
# E1 r estimation error modelling.
e1_model <- buildmer(difference ~ contrast +
(1 + contrast | participant) +
(1 + contrast | item),
data = E1_uniform_adjustments_tidy)
# E1 r estimation error model without fixed effect of contrast.
e1_model_comparison <- comparison(e1_model)
# Extract ANOVA results for E1 r estimation errors.
anova_results(e1_model, e1_model_comparison)
effects_df <- get_effects_sizes(e1_model, E1_uniform_adjustments_tidy)
# outputs summary statistics for E1 model.
contrasts_e1 <- contrasts_extract(e1_model) %>%
mutate(p.value = scales::pvalue(p.value)) %>%
mutate(Contrast = recode(Contrast,
"A - D" = "Low contrast (A) : Full contrast (D)",
"A - C" = "Low contrast (A) : High contrast (C)",
"A - B" = "Low contrast (A) : Medium contrast (B)",
"D - C" = "Full contrast (D) : High contrast (C)",
"D - B" = "Full contrast (D) : Medium contrast (B)",
"C - B" = "High contrast (C) : Medium contrast (B)"))
knitr::kable(contrasts_e1, booktabs = TRUE, digits = c(0,2,3), caption = "\\label{contrasts-table-e1}Table showing the contrasts between different levels of the contrast factor in E1.")
# builds model with literacy as a fixed effect
e1_literacy <- lmer(add.terms(formula(e1_model), "literacy"),
data = E1_uniform_adjustments_tidy)
e1_model_lit_comparison <- e1_model
# extracts anova statistics for comparison with literacy as a fixed effect
anova_results(e1_model_lit_comparison, e1_literacy)
plot_error_bars_function(E1_uniform_adjustments_tidy, "slider.response", labels_e1)
get_effects_sizes(e1_model, E1_uniform_adjustments_tidy)
knitr::opts_chunk$set(echo = TRUE)
# Knitting this document requires tinytex (install.packages("tinytex"))
# For formatting to be correct, additional tinytex packages are required
# Run tinytex:::install_yihui_pkgs() before knitting
set.seed(1234) # seed for all random number generation
# Loading packages
library(rticles)
library(tidyverse)
library(MASS)
library(emmeans)
library(scales)
library(buildmer)
library(lme4)
library(kableExtra)
library(afex)
library(papaja)
library(broom.mixed)
library(insight)
library(qwraps2)
library(lmerTest)
library(tinylabels)
library(EMAtools)
library(ggdist)
library(ggpubr)
# Comment out the following line if additional tinytex packages are already installed
#tinytex:::install_yihui_pkgs()
# in this script, models are cached. If eval_models <- FALSE, script will load
# cached models. Set eval_models <- TRUE to rebuild models from scratch
eval_models <- FALSE
if (eval_models == FALSE){
lazyload_cache_dir('contrast_and_scatterplots_cache/latex')
}
# load in data files
contrast1_anon <- read_csv("data/data_E1_uniform_adjustments.csv")
contrast2_anon <- read_csv("data/data_E2_spatially_dependent.csv")
# function for wrangling data
wrangle <- function(anon_file) {
literacy <- anon_file %>%
filter(!is.na(q1_slider.response)) %>%
rowwise() %>%
mutate(literacy = sum(c(q1_slider.response,
q2_slider.response,
q3_slider.response,
q4_slider.response,
q5_slider.response))) %>%
dplyr::select(participant,
literacy)
# extract demographic information
# link slider response numbers to gender categories
demographics <- anon_file %>%
filter(!is.na(gender_slider.response)) %>%
mutate(gender_slider.response = recode(gender_slider.response,
`1` = "F",
`2` = "M",
`3` = "NB")) %>%
dplyr::select(matches(c("participant",
"age_textbox.text",
"gender_slider.response")))
# split plots_with_labels column into item and contrast condition columns
anon_file <- anon_file %>%
mutate(images = str_replace(images, pattern = "A", replacement = "-A")) %>%
mutate(images = str_replace(images, pattern = "B", replacement = "-B")) %>%
mutate(images = str_replace(images, pattern = "C", replacement = "-C")) %>%
mutate(images = str_replace(images, pattern = "D", replacement = "-D")) %>%
separate(images, c("item", "contrast"), sep = "-") %>%
mutate(contrast = str_replace(contrast, pattern = ".png", replacement = "")) %>%
mutate(item = str_replace(item, pattern = "all_plots/", replacement = ""))
# select relevant columns
# select only experimental items
# add literacy data
# change data types where appropriate
# output this file with suffix 'tidy'
anon_file %>%
dplyr::select(c("participant",
"item",
"contrast",
"slider.response",
"my_rs",
"total_residuals",
"unique_item_no",
"trials.thisN",
"session")) %>%
mutate(half = case_when(
trials.thisN < 93 ~ "First",
trials.thisN > 92 ~ "Second" )) %>%
filter(unique_item_no < 181) %>%
inner_join(literacy, by = "participant") %>%
inner_join(demographics, by = "participant") %>%
mutate(across(c("item", "contrast", "half"), as_factor)) %>%
dplyr::select(-c("__participant")) %>%
mutate(difference = my_rs - slider.response) %>%
mutate(contrast = fct_relevel(contrast, c('A', 'B', 'C', 'D'))) %>%
assign(paste0(unique(anon_file$expName), "_tidy"),
value = ., envir = .GlobalEnv)
}
# use wrangle function on anonmyised data files
walk(list(contrast1_anon,
contrast2_anon),
wrangle)
# Experiments were incorrectly named, so rename them
E1_uniform_adjustments_tidy <- E3_full_exp_tidy
E2_spatially_dependent_tidy <- E2_full_exp_tidy
# remove incorrectly named and anon dfs from environment
rm(E3_full_exp_tidy, E2_full_exp_tidy, contrast1_anon, contrast2_anon, wrangle)
# check for missing age values
sum(is.na(E1_uniform_adjustments_tidy$age_textbox.text))
sum(is.na(E2_spatially_dependent_tidy$age_textbox.text))
# print sessions with missing age values
E2_spatially_dependent_tidy %>%
filter(is.na(age_textbox.text)) %>%
distinct(session)
# no missing values in E1, some in E2.
# fill in missing age values from prolific_data.csv
# we can't include this as it contains personally
# identifiable Prolific IDs
#missing_age_a <- prolific_data %>%
#  filter(session == "_") %>%
#  pull(age_textbox.text)
#missing_age_b <- prolific_data %>%
#  filter(session == "_") %>%
#  pull(age_textbox.text)
#E2_spatially_dependent_tidy <- E2_spatially_dependent_tidy %>%
#  mutate(age_textbox.text = case_when(
#    session == "_" ~ missing_age_a,
#    session == "_" ~ missing_age_b,
#    TRUE ~ as.numeric(as.character(age_textbox.text))
#  ))
# this function takes a model and creates a nested model with the fixed effects
# term removed for anova comparison
comparison <- function(model) {
parens <- function(x) paste0("(",x,")")
onlyBars <- function(form) reformulate(sapply(findbars(form),
function(x)  parens(deparse(x))),
response=".")
onlyBars(formula(model))
cmpr_model <- update(model,onlyBars(formula(model)))
return(cmpr_model)
}
# this function takes two nested models, runs an anova, and the outputs the
# Chi-square statistic, the degrees of freedom, and the p value to the global environment
anova_results <- function(model, cmpr_model) {
model_name <- deparse(substitute(model))
if (class(model) == "buildmer") model <- model@model
if (class(cmpr_model) == "buildmer") cmpr_model <- cmpr_model@model
anova_output <- anova(model, cmpr_model)
assign(paste0(model_name, ".Chisq"),
anova_output$Chisq[2],
envir = .GlobalEnv)
assign(paste0(model_name, ".df"),
anova_output$Df[2],
envir = .GlobalEnv)
assign(paste0(model_name, ".p"),
anova_output$`Pr(>Chisq)`[2],
envir = .GlobalEnv)
}
# this function extracts test statistics and p values from model summaries
contrasts_extract <- function(model) {
model_name <- deparse(substitute(model))
if (class(model) == "buildmer") model <- model@model
EMMs <- emmeans(model, pairwise ~ contrast)
params <- as.data.frame(EMMs[2]) %>%
rename_with(str_replace,
pattern = "contrasts.", replacement = "",
matches("contrasts")) %>%
rename_with(str_to_title, !starts_with("p")) %>%
dplyr::select(c("Contrast", "Z.ratio", "p.value"))
return(params)
}
# generates summary statistics (mean and standard deviation)
sum_stats <- function(df) {
stats <- df %>%
filter(!is.na(difference)) %>%
group_by(contrast) %>%
summarise(mean = mean(difference),
sd = sd(difference)) %>%
rename_with(str_to_title) %>%
rename_with(str_to_upper, starts_with("S"))
return(stats)
}
get_effects_sizes <- function(model, d) {
effect_sizes <- lme.dscore(model, data = d, type = "lme4")
effects_df <- as.data.frame(effect_sizes[3])
return(effects_df)
}
dot_plot_function <- function(df) {
data <- df %>%
group_by(contrast) %>%
filter(!is.na(difference)) %>%
filter(!is.na(contrast)) %>%
summarise(
mean = mean(difference),
lci = t.test(difference, conf.level = 0.95)$conf.int[1],
hci = t.test(difference, conf.level = 0.95)$conf.int[2],
)
data %>%
mutate(contrast = fct_relevel(contrast, "A", "B", "C", "D")) %>%
ggplot(aes(x = contrast, y = mean)) +
geom_point() +
#coord_cartesian(ylim = c(0, max_error))
geom_errorbar(aes(ymin=lci, ymax=hci), colour="black", width=0.05, linewidth =1) +
theme_ggdist() +
labs(x = "Contrast Condition",
y = "Mean Error") +
theme(axis.text = element_text(size = 13),
axis.title = element_text(size = 16))
}
plot_sd_sd_function <- function(df){
df %>%
summarise(ppt_sd = sd(difference)) %>%
drop_na() %>%
group_by(contrast) %>%
summarise(mean_sd = mean(ppt_sd), sd_sd = sd(ppt_sd)) %>%
ggplot(aes(x = contrast, y = mean_sd)) +
geom_point(size = 2) +
geom_errorbar(aes(ymin = mean_sd - sd_sd, ymax = mean_sd + sd_sd), width = 0.05, linewidth = 1) +
theme_ggdist() +
ylim(0, .3) +
labs(x = "Contrast Condition",
y = "Mean Standard Deviation") +
theme(axis.text = element_text(size = 13),
axis.title = element_text(size = 16))
}
plot_error_bars_function <- function(df, measure, l){
df %>%
drop_na() %>%
group_by(contrast, my_rs) %>%
summarise(sd = sd(get(measure)), mean = mean(get(measure))) %>%
ggplot(aes(x = my_rs, y = mean)) +
geom_point(size = 0.2) +
geom_errorbar(mapping = aes(ymin = mean + sd, ymax = mean - sd),width = 0.01, size = 0.3) +
geom_hline(yintercept = 0, linetype = 2) +
theme_ggdist() +
theme(strip.text = element_text(size = 6, margin = margin(1,0,1,0, "mm"))) +
facet_wrap(contrast ~., ncol = 4, labeller = labeller(contrast = l)) +
labs(x = "Objective r",
y = "Mean r estimation")
}
labels_e1 <- c(A = "Low Contrast (A)", B = "Medium Contrast (B)", C = "High Contrast (C)", D = "Full Contrast (D)")
labels_e2 <- c(A = "Non-Linear Decay (A)", B = "Linear Decay (B)", C = "Inverted Decay (C)", D = "No Decay (D)")
my_rs <- seq(from = 0, to = 1, length.out = 100)
as_tibble(my_rs) %>%
mutate(under_est = (log(1-0.88*my_rs)/log(1-0.88))) %>%
ggplot() +
geom_smooth(aes(x = my_rs, y = under_est)) +
ylim(0,1) +
xlim(0,1) +
theme_minimal() +
labs(x = "Objective r value",
y = "Subjective r value")
x1 <- seq(0,1, length.out = 11)
y1 <- rep(1, times = 11)
df <- data.frame(x1, y1)
ggplot(aes(x1, y1), data = df) +
geom_point(alpha = x1, size = 18, shape = 16) +
theme(panel.background = element_blank(),
axis.ticks = element_blank(),
axis.text.y = element_blank(),
axis.title = element_blank(),
plot.title = element_text(size = 16),
axis.text.x = element_text(size = 14)) +
scale_x_continuous(breaks = scales::pretty_breaks(n = 11)) +
labs(title = "Effect of Alpha Values on Point Appearance")
rm(x1,y1,df)
knitr::include_graphics("images/example-plots.png")
knitr::include_graphics("images/example-trial.png")
ggqqplot(E1_uniform_adjustments_tidy$difference, size = 0.75) + ggtitle("Experiment 1: Uniform Adjustments") +
theme(plot.title = element_text(size = 18))
ggqqplot(E2_spatially_dependent_tidy$difference, size = 0.75) + ggtitle("Experiment 2: Spatially Dependent Adjustments") +
theme(plot.title = element_text(size = 18))
# extract age data
age_e1 <- distinct(E1_uniform_adjustments_tidy, participant,
.keep_all = TRUE) %>%
summarise(mean = mean(age_textbox.text, na.rm = TRUE),
sd = sd(age_textbox.text, na.rm = TRUE))
# extract gender data
gender_e1 <- distinct(E1_uniform_adjustments_tidy, participant,
.keep_all = TRUE) %>%
group_by(gender_slider.response) %>%
summarise(perc = n()/nrow(.)*100) %>%
pivot_wider(names_from = gender_slider.response, values_from = perc)
# extract literacy data
literacy_e1 <- distinct(E1_uniform_adjustments_tidy, participant,
.keep_all = TRUE) %>%
summarise(mean = mean(literacy), sd = sd(literacy))
set.seed(1234)
my_sample_size = 128
my_desired_r = 0.6
mean_variable_1 = 0
sd_variable_1 = 1
mean_variable_2 = 0
sd_variable_2 = 1
mu <- c(mean_variable_1, mean_variable_2)
myr <- my_desired_r * sqrt(sd_variable_1) * sqrt(sd_variable_2)
mysigma <- matrix(c(sd_variable_1, myr, myr, sd_variable_2), 2, 2)
corr_data = as_tibble(mvrnorm(my_sample_size, mu, mysigma, empirical = TRUE))
corr_model <- lm(V2 ~ V1, data = corr_data)
my_residuals <- abs(residuals(corr_model))
data_with_resid <- round(cbind(corr_data, my_residuals), 2)
plot_example_function <- function (d, x, t) {
ggplot(d, aes(x = V1, y = V2)) +
scale_alpha_identity() +
geom_point(aes(alpha = x), shape = 16, size = 3)  +
labs(x = "", y = "") +
theme_classic() +
theme(axis.text = element_blank(),
plot.margin = unit(c(0,0,0,0), "cm"),
legend.position = "none",
plot.title = element_text(size = 30)) +
labs(title = t)
}
plot_example_function(data_with_resid, 0.25, "Contrast Alpha = 0.25")
plot_example_function(data_with_resid, 0.5, "Contrast Alpha = 0.5")
plot_example_function(data_with_resid, 0.75, "Contrast Alpha = 0.75")
plot_example_function(data_with_resid, 1, "Contrast Alpha = 1")
dot_plot_function(E1_uniform_adjustments_tidy) +
scale_x_discrete(labels = c("Low Contrast\nalpha = 0.25 (A)",
"Medium Contrast\nalpha = 0.5 (B)",
"High Contrast\nalpha = 0.75 (C)",
"Full Contrast\nalpha = 1 (D)"))
# E1 r estimation error modelling.
e1_model <- buildmer(difference ~ contrast +
(1 + contrast | participant) +
(1 + contrast | item),
data = E1_uniform_adjustments_tidy)
# E1 r estimation error model without fixed effect of contrast.
e1_model_comparison <- comparison(e1_model)
# Extract ANOVA results for E1 r estimation errors.
anova_results(e1_model, e1_model_comparison)
effects_df <- get_effects_sizes(e1_model, E1_uniform_adjustments_tidy)
# outputs summary statistics for E1 model.
contrasts_e1 <- contrasts_extract(e1_model) %>%
mutate(p.value = scales::pvalue(p.value)) %>%
mutate(Contrast = recode(Contrast,
"A - D" = "Low contrast (A) : Full contrast (D)",
"A - C" = "Low contrast (A) : High contrast (C)",
"A - B" = "Low contrast (A) : Medium contrast (B)",
"D - C" = "Full contrast (D) : High contrast (C)",
"D - B" = "Full contrast (D) : Medium contrast (B)",
"C - B" = "High contrast (C) : Medium contrast (B)"))
knitr::kable(contrasts_e1, booktabs = TRUE, digits = c(0,2,3), caption = "\\label{contrasts-table-e1}Table showing the contrasts between different levels of the contrast factor in E1.")
# builds model with literacy as a fixed effect
e1_literacy <- lmer(add.terms(formula(e1_model), "literacy"),
data = E1_uniform_adjustments_tidy)
e1_model_lit_comparison <- e1_model
# extracts anova statistics for comparison with literacy as a fixed effect
anova_results(e1_model_lit_comparison, e1_literacy)
plot_error_bars_function(E1_uniform_adjustments_tidy, "slider.response", labels_e1)
plot_sd_sd_function(E1_uniform_adjustments_tidy %>% group_by(participant, contrast)) +
scale_x_discrete(labels = c(
"Low\ncontrast (A)",
"Medium\ncontrast (B)",
"High\ncontrast (C)",
"Full\ncontrast (D)"))
# extract age data
age_e2 <- distinct(E2_spatially_dependent_tidy, participant,
.keep_all = TRUE) %>%
summarise(mean = mean(age_textbox.text, na.rm = TRUE),
sd = sd(age_textbox.text, na.rm = TRUE))
# extract gender data
gender_e2 <- distinct(E2_spatially_dependent_tidy, participant,
.keep_all = TRUE) %>%
group_by(gender_slider.response) %>%
summarise(perc = n()/nrow(.)*100) %>%
pivot_wider(names_from = gender_slider.response, values_from = perc)
# extract literacy data
literacy_e2 <- distinct(E2_spatially_dependent_tidy, participant,
.keep_all = TRUE) %>%
summarise(mean = mean(literacy), sd = sd(literacy))
set.seed(1234)
my_sample_size = 128
my_desired_r = 0.6
mean_variable_1 = 0
sd_variable_1 = 1
mean_variable_2 = 0
sd_variable_2 = 1
mu <- c(mean_variable_1, mean_variable_2)
myr <- my_desired_r * sqrt(sd_variable_1) * sqrt(sd_variable_2)
mysigma <- matrix(c(sd_variable_1, myr, myr, sd_variable_2), 2, 2)
corr_data = as_tibble(mvrnorm(my_sample_size, mu, mysigma, empirical = TRUE))
corr_model <- lm(V2 ~ V1, data = corr_data)
my_residuals <- abs(residuals(corr_model))
data_with_resid <- round(cbind(corr_data, my_residuals), 2)
slopes <- data_with_resid %>%
mutate(slope_linear = my_residuals/3.2) %>%
mutate(slope_0.25 = 1-(0.25)^my_residuals) %>%
mutate(slope_inverted = (1 + (0.25)^ my_residuals)-1)
plot_example_function(slopes, (1-slopes$slope_0.25), "Non-linear Decay (b = 0.25)")
plot_example_function(slopes, (1-slopes$slope_linear), "Linear Decay")
plot_example_function(slopes, (1-slopes$slope_inverted), "Inverted Non-linear Decay")
plot_example_function(slopes, 1, "No Decay")
library(MASS)
set.seed(1234)
my_desired_r = 0.2
my_sample_size = 128
mean_variable_1 = 0
sd_variable_1 = 1
mean_variable_2 = 0
sd_variable_2 = 1
mu <- c(mean_variable_1, mean_variable_2)
myr <- my_desired_r * sqrt(sd_variable_1) * sqrt(sd_variable_2)
mysigma <- matrix(c(sd_variable_1, myr, myr, sd_variable_2), 2, 2)
corr_data = as_tibble(mvrnorm(my_sample_size, mu, mysigma, empirical = TRUE))
corr_model <- lm(V2 ~ V1, data = corr_data)
my_residuals <- abs(residuals(corr_model))
data_with_resid <- round(cbind(corr_data, my_residuals), 2)
slopes <- data_with_resid %>%
mutate(decay_linear = ((-my_residuals/2.6) + 1)) %>%
mutate(decay_inverted = 1-(0.25)^my_residuals) %>%
mutate(decay_non_linear = (1 + (0.25)^ my_residuals)-1) %>%
pivot_longer(cols = starts_with("de"),
names_to = c("decay"),
values_to = "transformed_residual")
slopes %>%
mutate(decay = str_replace_all(decay, pattern = "_", replacement = " ")) %>%
mutate(decay = str_to_title(decay)) %>%
ggplot(aes(x = my_residuals, y = transformed_residual)) +
geom_line(aes(colour = decay)) +
scale_x_continuous(breaks = scales::pretty_breaks(n = 20), limits = c(0,2.6)) +
labs(x = "Residual",
y = "Contrast Alpha",
title = "Relationship between residual and contrast alpha value") +
theme_minimal() +
theme(legend.title = element_blank(),
legend.position = "none") +
annotate(geom = "text", x  = 1.3, y = 0.12, label = "Non-Linear Decay", angle = -20) +
annotate(geom = "text", x  = 1.3, y = 0.44, label = "Linear Decay", angle = -30) +
annotate(geom = "text", x  = 2, y = 0.88, label = "Non-Linear Inverted Decay", angle = 8)
coord_cartesian(xlim = c(0,2.6), ylim = c(0,1))
# plot dot plot for e2
dot_plot_function(E2_spatially_dependent_tidy) +
scale_x_discrete(labels = c("Non-Linear\nDecay (A)",
"Linear Decay (B)",
"Non-Linear\nInverted Decay (C)",
"Full Contrast (D)"))
# E2 r estimation error modelling.
e2_model <- buildmer(difference ~ contrast +
(1 + contrast | participant) +
(1 + contrast | item),
data = E2_spatially_dependent_tidy)
# E2 r estimation error model without fixed effect of contrast.
e2_model_comparison <- comparison(e2_model)
# extract ANOVA results for E2 r estimation errors.
anova_results(e2_model, e2_model_comparison)
# E2 r estimation error modelling with low r range
E2_low_range <- E2_spatially_dependent_tidy %>%
#filter(contrast == c("B", "D")) %>%
filter(my_rs < 0.6)
e2_model_low_range <- buildmer(difference ~ contrast +
(1 + contrast | participant) +
(1 + contrast | item),
data = E2_low_range)
get_effects_sizes(e2_model, E2_spatially_dependent_tidy)
warnings()
install.packages("pwrss")
library(pwrss)
pwrss.f.rmanova(eta2 = 0.1)
pwrss.f.rmanova(eta2 = 0.1, power = 0.05)
pwrss.f.rmanova(eta2 = 0.1, power = NULL, n = 10)
pwrss.f.rmanova(eta2 = 0.1, power = 0.54, n = NULL)
